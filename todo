#!/bin/sh
_todo_all() {
  _todo_list
}

_todo_list() {
  project="$1"
  if [ "$project" ]; then
    shift
  else
    project=*
  fi
  awk '/^[-|+] / {print}; /^## COMP/ {nextfile}' $TODOS_DIR/$project 2>/dev/null
}

_todo_today() {
  project="$1"
  if [ "$project" ]; then
    shift
  else
    project=*
  fi
  awk '/^\+ / {n = split(FILENAME, p, "/"); \
               print p[n] ": " $0}' $TODOS_DIR/$project 2>/dev/null
}

_todo_bricks() {
  project="$1"
  if [ "$project" ]; then
    shift
  else
    project=*
  fi
  awk '/^\+ / {n = split(FILENAME, p, "/"); \
               print p[n] ": " $0; nextfile}' $TODOS_DIR/$project 2>/dev/null
}

action="$1"
[ "$action" ] && shift
case "${action}" in
  list) _todo_list "$@" ;;
  today) _todo_today "$@" ;;
  bricks) _todo_bricks "$@" ;;
  *) _todo_all ;;
esac
